<!DOCTYPE html>
<html lang="en">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    
    <meta charset="utf-8">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="referrer" content="no-referrer">

<meta name="description" content="still finding myselfğŸ£">
<title>
    PGO - Coder &amp;&amp; Gamer
</title>


<link rel="shortcut icon" href="/sam.ico">







<link rel="stylesheet" href="/css/main.css" media="screen">




  






<link rel="stylesheet" href="/fonts/didact_gothic/Didact_Gothic.css">




<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="http://localhost:1313/tn.png" /><meta name="twitter:title" content="PGO"/>
<meta name="twitter:description" content="Profile-Guided Optimization&nbsp;Â¶ PGO ç±»ä¼¼äºä¸€ç§åŸºäº CPU pprof çš„ç¼–è¯‘ä¼˜åŒ–æœºåˆ¶ï¼Œå°†æœ¬æ¬¡æˆ–ä¹‹å‰çš„ CPU pprof æ–‡ä»¶ç”¨äºä¼˜åŒ–ä¸‹ä¸€æ¬¡ç¼–è¯‘ï¼Œå¦‚é’ˆå¯¹é¢‘ç¹è°ƒç”¨çš„å‡½æ•°ï¼Œç¼–è¯‘å™¨å¯ä»¥æ›´æœæ–­çš„å°†å…¶å†…è”ã€‚
Collecting profiles&nbsp;Â¶ Profiles generated by the Go runtime (such as fromÂ runtime/pprofÂ andÂ net/http/pprof) can be used directly as the compiler input. It may also be possible to use/convert profiles from other profiling systems.
For best results, it is important that profiles areÂ representativeÂ of actual behavior in the applicationâ€™s production environment. Thus, collecting profiles directly from the production environment is recommended, and is the primary method that Goâ€™s PGO is designed for."/>

<meta property="og:title" content="PGO" />
<meta property="og:description" content="Profile-Guided Optimization&nbsp;Â¶ PGO ç±»ä¼¼äºä¸€ç§åŸºäº CPU pprof çš„ç¼–è¯‘ä¼˜åŒ–æœºåˆ¶ï¼Œå°†æœ¬æ¬¡æˆ–ä¹‹å‰çš„ CPU pprof æ–‡ä»¶ç”¨äºä¼˜åŒ–ä¸‹ä¸€æ¬¡ç¼–è¯‘ï¼Œå¦‚é’ˆå¯¹é¢‘ç¹è°ƒç”¨çš„å‡½æ•°ï¼Œç¼–è¯‘å™¨å¯ä»¥æ›´æœæ–­çš„å°†å…¶å†…è”ã€‚
Collecting profiles&nbsp;Â¶ Profiles generated by the Go runtime (such as fromÂ runtime/pprofÂ andÂ net/http/pprof) can be used directly as the compiler input. It may also be possible to use/convert profiles from other profiling systems.
For best results, it is important that profiles areÂ representativeÂ of actual behavior in the applicationâ€™s production environment. Thus, collecting profiles directly from the production environment is recommended, and is the primary method that Goâ€™s PGO is designed for." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:1313/posts/pgo/" /><meta property="og:image" content="http://localhost:1313/tn.png" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-11-27T01:52:20+08:00" />
<meta property="article:modified_time" content="2022-11-27T01:52:20+08:00" /><meta property="og:site_name" content="todo" />



    

    
    
    
</head>

<body>
    
    
    <header class="wrap flex-container">
        <h1>PGO</h1>
    </header>
    
    <main class="wrap">
        
<div class="flex-container">
    <aside role="complementary">
        Sun Nov 27, 2022 &#183; 182 words
        <div class="tag-container">
            
            
            <span class="tag">
                <a href="/tags/blog/">
                    blog
                </a>
            </span>
            
            
        </div>
    </aside>
    <hr />
    <article role="article">
        
<h1 id="profile-guided-optimization" class="anchor-link"><a href="#profile-guided-optimization">Profile-Guided Optimization<span class="pilcrow">&nbsp;Â¶</span></a></h1>
<p>PGO ç±»ä¼¼äºä¸€ç§åŸºäº CPU pprof çš„ç¼–è¯‘ä¼˜åŒ–æœºåˆ¶ï¼Œå°†æœ¬æ¬¡æˆ–ä¹‹å‰çš„ CPU pprof æ–‡ä»¶ç”¨äºä¼˜åŒ–ä¸‹ä¸€æ¬¡ç¼–è¯‘ï¼Œå¦‚é’ˆå¯¹é¢‘ç¹è°ƒç”¨çš„å‡½æ•°ï¼Œç¼–è¯‘å™¨å¯ä»¥æ›´æœæ–­çš„å°†å…¶å†…è”ã€‚</p>

<h3 id="collecting-profiles" class="anchor-link"><a href="#collecting-profiles">Collecting profiles<span class="pilcrow">&nbsp;Â¶</span></a></h3>
<p>Profiles generated by the Go runtime (such as fromÂ <a href="https://pkg.go.dev/runtime/pprof">runtime/pprof</a>Â andÂ <a href="https://pkg.go.dev/net/http/pprof">net/http/pprof</a>) can be used directly as the compiler input. It may also be possible to use/convert profiles from other profiling systems.</p>
<p>For best results, it is important that profiles areÂ representativeÂ of actual behavior in the applicationâ€™s production environment.
Thus, collecting profiles directly from the production environment is recommended, and is the primary method that Goâ€™s PGO is designed for.</p>

<h4 id="typical-workflow" class="anchor-link"><a href="#typical-workflow">typical workflow<span class="pilcrow">&nbsp;Â¶</span></a></h4>
<ol>
<li>Build and release an initial binary (without PGO).</li>
<li>Collect profiles from production.</li>
<li>When itâ€™s time to release an updated binary, build from the latest source and provide the production profile.</li>
<li>GOTO 2</li>
</ol>

<h3 id="building-with-pgo" class="anchor-link"><a href="#building-with-pgo">Building with PGO<span class="pilcrow">&nbsp;Â¶</span></a></h3>
<p><code>go build -pgo</code> flag æ§åˆ¶ PGO profile çš„é€‰æ‹©ï¼Œ<code>-pgo=off</code> ä¸ºå…³é—­ã€‚æ ‡å‡†çš„ä½¿ç”¨æ–¹æ³•ä¸ºå°† CPU pprof æ–‡ä»¶æ”¾åœ¨ main package æ–‡ä»¶å¤¹ä¸‹ï¼Œå‘½åä¸º default. pgo ï¼Œä½¿ç”¨ <code>-pgo=auto</code> ä¼šé»˜è®¤é€‰ç”¨ default. pgo æ–‡ä»¶ã€‚</p>
<p>æ¨èæäº¤ profile æ–‡ä»¶åˆ°æºä»£ç ä¸­ï¼Œprofile æ–‡ä»¶ä½œä¸ºæ„å»ºè¾“å…¥å¯¹äºæ„å»ºå¯å¤ç”¨ã€é«˜æ€§èƒ½åº”ç”¨æ˜¯ååˆ†é‡è¦çš„ã€‚</p>
<blockquote>
<p>[!Notes]+
In Go 1.20,Â <code>-pgo=auto</code>Â only works with a single main package. Attempting to build multiple main packages (<code>go build -pgo=auto ./cmd/foo ./cmd/bar</code>) will result in a build error. This isÂ <a href="https://go.dev/issue/58099">https://go.dev/issue/58099</a>.</p>
</blockquote>

<h1 id="reference" class="anchor-link"><a href="#reference">Reference<span class="pilcrow">&nbsp;Â¶</span></a></h1>
<ol>
<li><a href="https://go.dev/doc/pgo">Profile-guided optimization</a></li>
</ol>

    </article>
</div>


        
<nav role="navigation" class="flex-container bottom-menu">
    
<hr />
<p>


    
        <a href="/posts">back</a>
        
            &#183;
        
    

    
        
            
            <a href="/gallery">gallery</a>
        
            
                &#183;
            
            <a href="/posts">blog</a>
        
            
                &#183;
            
            <a href="/about">about me</a>
        
        
        
            &#183; 
            <a href="/">
                main
            </a>
        
    
</p>
</nav>

    </main>
    
    <footer class="flex-container footer">a theme for Hugo.
</footer>
    
    
</body>

</html>
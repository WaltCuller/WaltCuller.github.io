<!DOCTYPE html>
<html lang="en">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    
    <meta charset="utf-8">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="referrer" content="no-referrer">

<meta name="description" content="still finding myself🐣">
<title>
    PGO - Coder &amp;&amp; Gamer
</title>


<link rel="shortcut icon" href="/sam.ico">







<link rel="stylesheet" href="/css/main.css" media="screen">




  






<link rel="stylesheet" href="/fonts/didact_gothic/Didact_Gothic.css">




<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="http://localhost:1313/tn.png" /><meta name="twitter:title" content="PGO"/>
<meta name="twitter:description" content="Profile-Guided Optimization&nbsp;¶ PGO 类似于一种基于 CPU pprof 的编译优化机制，将本次或之前的 CPU pprof 文件用于优化下一次编译，如针对频繁调用的函数，编译器可以更果断的将其内联。
Collecting profiles&nbsp;¶ Profiles generated by the Go runtime (such as from runtime/pprof and net/http/pprof) can be used directly as the compiler input. It may also be possible to use/convert profiles from other profiling systems.
For best results, it is important that profiles are representative of actual behavior in the application’s production environment. Thus, collecting profiles directly from the production environment is recommended, and is the primary method that Go’s PGO is designed for."/>

<meta property="og:title" content="PGO" />
<meta property="og:description" content="Profile-Guided Optimization&nbsp;¶ PGO 类似于一种基于 CPU pprof 的编译优化机制，将本次或之前的 CPU pprof 文件用于优化下一次编译，如针对频繁调用的函数，编译器可以更果断的将其内联。
Collecting profiles&nbsp;¶ Profiles generated by the Go runtime (such as from runtime/pprof and net/http/pprof) can be used directly as the compiler input. It may also be possible to use/convert profiles from other profiling systems.
For best results, it is important that profiles are representative of actual behavior in the application’s production environment. Thus, collecting profiles directly from the production environment is recommended, and is the primary method that Go’s PGO is designed for." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:1313/posts/pgo/" /><meta property="og:image" content="http://localhost:1313/tn.png" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-11-27T01:52:20+08:00" />
<meta property="article:modified_time" content="2022-11-27T01:52:20+08:00" /><meta property="og:site_name" content="todo" />



    

    
    
    
</head>

<body>
    
    
    <header class="wrap flex-container">
        <h1>PGO</h1>
    </header>
    
    <main class="wrap">
        
<div class="flex-container">
    <aside role="complementary">
        Sun Nov 27, 2022 &#183; 182 words
        <div class="tag-container">
            
            
            <span class="tag">
                <a href="/tags/blog/">
                    blog
                </a>
            </span>
            
            
        </div>
    </aside>
    <hr />
    <article role="article">
        
<h1 id="profile-guided-optimization" class="anchor-link"><a href="#profile-guided-optimization">Profile-Guided Optimization<span class="pilcrow">&nbsp;¶</span></a></h1>
<p>PGO 类似于一种基于 CPU pprof 的编译优化机制，将本次或之前的 CPU pprof 文件用于优化下一次编译，如针对频繁调用的函数，编译器可以更果断的将其内联。</p>

<h3 id="collecting-profiles" class="anchor-link"><a href="#collecting-profiles">Collecting profiles<span class="pilcrow">&nbsp;¶</span></a></h3>
<p>Profiles generated by the Go runtime (such as from <a href="https://pkg.go.dev/runtime/pprof">runtime/pprof</a> and <a href="https://pkg.go.dev/net/http/pprof">net/http/pprof</a>) can be used directly as the compiler input. It may also be possible to use/convert profiles from other profiling systems.</p>
<p>For best results, it is important that profiles are representative of actual behavior in the application’s production environment.
Thus, collecting profiles directly from the production environment is recommended, and is the primary method that Go’s PGO is designed for.</p>

<h4 id="typical-workflow" class="anchor-link"><a href="#typical-workflow">typical workflow<span class="pilcrow">&nbsp;¶</span></a></h4>
<ol>
<li>Build and release an initial binary (without PGO).</li>
<li>Collect profiles from production.</li>
<li>When it’s time to release an updated binary, build from the latest source and provide the production profile.</li>
<li>GOTO 2</li>
</ol>

<h3 id="building-with-pgo" class="anchor-link"><a href="#building-with-pgo">Building with PGO<span class="pilcrow">&nbsp;¶</span></a></h3>
<p><code>go build -pgo</code> flag 控制 PGO profile 的选择，<code>-pgo=off</code> 为关闭。标准的使用方法为将 CPU pprof 文件放在 main package 文件夹下，命名为 default. pgo ，使用 <code>-pgo=auto</code> 会默认选用 default. pgo 文件。</p>
<p>推荐提交 profile 文件到源代码中，profile 文件作为构建输入对于构建可复用、高性能应用是十分重要的。</p>
<blockquote>
<p>[!Notes]+
In Go 1.20, <code>-pgo=auto</code> only works with a single main package. Attempting to build multiple main packages (<code>go build -pgo=auto ./cmd/foo ./cmd/bar</code>) will result in a build error. This is <a href="https://go.dev/issue/58099">https://go.dev/issue/58099</a>.</p>
</blockquote>

<h1 id="reference" class="anchor-link"><a href="#reference">Reference<span class="pilcrow">&nbsp;¶</span></a></h1>
<ol>
<li><a href="https://go.dev/doc/pgo">Profile-guided optimization</a></li>
</ol>

    </article>
</div>


        
<nav role="navigation" class="flex-container bottom-menu">
    
<hr />
<p>


    
        <a href="/posts">back</a>
        
            &#183;
        
    

    
        
            
            <a href="/gallery">gallery</a>
        
            
                &#183;
            
            <a href="/posts">blog</a>
        
            
                &#183;
            
            <a href="/about">about me</a>
        
        
        
            &#183; 
            <a href="/">
                main
            </a>
        
    
</p>
</nav>

    </main>
    
    <footer class="flex-container footer">a theme for Hugo.
</footer>
    
    
</body>

</html>